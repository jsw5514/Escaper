# Escaper
미로탈출게임, 스마트폰게임프로그래밍 프로젝트<br>

#### 게임 컨셉 ####
플레이어가 NPC의 추격을 따돌리며 미로를 탈출하는 퍼즐게임<br>
화면 슬라이드로 캐릭터를 조작할 수 있다.<br>
시작지점에서 출발하여 도착지점에 도달하는것이 목적이며 도중에 NPC에게 잡힐경우 게임 오버로 시작지점으로 돌아간다.<br>
중간에 아이템을 획득하면 추가 점수를 받는다.<br>
도착지점에 도달하면 클리어 점수를 받으며 다음 스테이지로 이동한다.<br>
<br>

#### 개발범위 ####
##### 1. 미로 #####
미로 크기: 21 * 21 타일 맵 구조 (벽 제외 10 * 10)<br>
미로 종류: 사전에 정의한 맵 3종류 사용<br>

##### 2. 플레이어 #####
이동: 화면 슬라이드를 이용하여 상하좌우 이동<br>

##### 3. NPC(적) #####
이동: 미리 설정된 경로를 따라 일정 범위내에서 이동(Path 이용)<br>
수: 맵에 따라 1~2명 배치<br>
속도: 플레이어와 동일<br>

##### 4. 아이템 #####
수: 맵에 따라 1~2개 배치<br>
획득 점수: 아이템의 종류에 따라 각각 100점, 200점, 300점으로 분류<br>

##### 5. UI 구성 #####
시작화면: 시작, 종료, 리더보드 버튼으로 구성<br>
   시작버튼->게임화면으로 이동<br>
   종료버튼->종료<br>
   리더보드 버튼->리더보드를 표시<br>
게임화면: 일시정지 버튼을 포함한 메인씬, 일시정지 화면용 퍼즈씬으로 구성<br>
   메인씬: 게임프레임워크를 이용하여 구성. 미로, 플레이어 캐릭터 등 게임요소 표시<br>
   일시정지 버튼: 누를시 게임뷰의 모든것이 멈추며 화면 중앙에 재시작, 종료 버튼 표시<br>
      재시작: 일시정지 이전의 상태로 돌아간다.<br>
      종료: 시작화면으로 돌아간다.<br>
   조이스틱: 플레이어 이동을 위한 상하좌우 4방향, 4개의 버튼으로 구성<br>
<br>

## 게임 실행 흐름 ##

### 시작 화면(MainActivity) ###
![Image](https://github.com/user-attachments/assets/ef8408eb-4832-4e3f-b19c-4a8387af8d25)
<br>
시작버튼 터치-> 게임화면으로 이동<br>
리더보드 버튼 터치 -> 리더보드 화면으로 이동<br>
종료버튼 터치 -> 앱 종료<br>
<br>

### 리더보드 화면(LeaderBoardActivity) ###
![Image](https://github.com/user-attachments/assets/9c6d2f2e-791f-4303-b3cc-bc75dec01549)
최고점수를 기록하는 리더보드<br>
back 버튼(기기의 물리적 back 버튼) -> 시작화면으로 이동<br>

### 게임 화면(EscaperActivity 내 MainScene) ###
![Image](https://github.com/user-attachments/assets/8e676690-8ec1-4ea7-8044-eda08e3343f0)
일시정지 버튼 -> 게임 일시정지 및 일시정지 메뉴 표시<br>
화면 슬라이드 -> 플레이어 캐릭터 이동<br>

### 게임 클리어 화면(EscaperActivity 내 MainScene, GetNameDialog) ###
![Image](https://github.com/user-attachments/assets/6ee14e33-54ab-49ab-aba5-703eb6e06001)
EditText -> 리더보드에 등록할 이름 입력<br>
등록 버튼 -> 점수 저장 후 시작 화면으로 이동<br>
등록 거부 버튼 -> 점수를 저장하지 않고 시작 화면으로 이동<br>

### 일시정지 메뉴(EscaperActivity 내 PauseScene) ###
![Image](https://github.com/user-attachments/assets/2e47cc25-a70b-41cf-b173-42a395bf7278)
삼각형 버튼(좌측 버튼) -> 일시정지 해제 후 재개<br>
집 모양 버튼(우측 버튼) -> 이름 입력 창을 띄움(게임 클리어 화면과 거의 동일)<br>

### 일시정지 메뉴(EscaperActivity 내 PauseScene, GetNameDialog) ###
![Image](https://github.com/user-attachments/assets/60a516e9-e1cc-4596-9a8c-efb08aaba33e)
EditText -> 리더보드에 등록할 이름 입력<br>
등록 버튼 -> 점수 저장 후 시작 화면으로 이동<br>
등록 거부 버튼 -> 점수를 저장하지 않고 시작 화면으로 이동<br>
취소 버튼 -> 종료를 취소하고 일시정지 화면으로 돌아감<br>


### 플레이어 캐릭터 이동 설명 ###
화면(어디든지)을 슬라이드하면 그 방향으로 캐릭터가 한 칸 이동(대각선으로 슬라이드할 경우 가로 세로 이동폭 중 큰 쪽으로 이동)<br>

### 개발 일정 ###
1 ~ 5주차: 타일 맵 구현<br>
6주차: 플레이어, NPC, 아이템 표시 및 이동 구현<br>
7주차: 플레이어, NPC, 아이템, 벽 충돌감지 구현<br>
8주차: 점수 계산 및 리더보드 구현, 일시정지 구현, 테스트 및 디버깅<br>

### 3차 발표자료 ###
#### 현재까지 진행상황 ####
1. 미로(100%)
2. 플레이어(100%)
3. NPC(100%)
4. 아이템(100%)
5. 리더보드(100%)
6. 일시정지(100%)

#### 깃허브 커밋 자료 ####
![Image](https://github.com/user-attachments/assets/2286ab23-f851-4f00-8321-b0c398432f51)
| 주차 | 커밋 수 |
|------|--------|
| 1주차 | 8 |
| 2주차 | 0 |
| 3주차 | 0 |
| 4주차 | 3 |
| 5주차 | 23 |
| 6주차 | 21 |
| 7주차 | 0 |
| 8주차 | 12 |
| 9주차 | 11 |
|10주차 | 11 |
|11주차 | 12 |

#### 주차별 개발목표 ####
1주차<br>
미로 맵 디자인, 조이스틱 이동 구현 시작<br>
2주차<br>
조이스틱 이동 구현<br>
3주차<br>
NPC, 아이템 추가<br>
4주차<br>
NPC, 아이템 충돌감지<br>
5주차<br>
점수 계산 추가<br>
6주차<br>
최고 점수를 기록하는 리더보드 구현<br>
7 ~ 8주차<br>
테스트 및 디버깅<br>

#### 실제 주차별 개발 진행 ####
1 ~ 6주차<br>
타일맵 구현<br>
7 ~ 8주차<br>
플레이어, 적 NPC 추가<br>
9주차<br>
타일맵에 오브젝트 레이어 추가<br>
10주차<br>
아이템 추가, 플레이어, 적 NPC, 아이템 간 충돌감지 구현, 리더보드 구현 시작<br>
11주차<br>
리더보드 구현 마무리, 일시정지 구현, 아이템 구현 마무리, 테스트 및 디버깅<br>

##### 개발 목표 변경 사항 및 이유 #####
타일맵 개발이 길어짐에 따라 이후 개발 목표에 전체적인 변경이 필요해졌습니다. 추가로 충돌감지, 일시정지 등 최종 목표에는 존재하지만 주차별 개발목표에 포함되지 않은 부분을 추가했습니다.<br>
<br>
플레이어 이동방식 변경: 조이스틱-> 화면 슬라이드로 변경<br>
<br>
변경이유: 화면 비율에 따라 조이스틱이 화면을 가릴 우려가 있고 플레이어 이동이 4방향에 그리드 기반으로 간단하기 때문에 변경했습니다.<br>

#### 사용된 기술 ####
Tiled 맵 에디터를 이용한 맵 제작 및 json 파일로의 export<br>
JsonObject를 이용한 json 파일 파싱<br>
재귀적 백트래킹 알고리즘을 이용한 랜덤 미로 맵 생성 등<br>

#### 참고한 것들 ####
##### 게임 에셋 관련 #####
itch.io<br>
https://itch.io/

##### 맵 제작 관련 #####
랜덤 미로 생성 알고리즘 정리<br>
https://dev-nicitis.tistory.com/5

##### 캐릭터 이동방식 #####
Baba Is You(안드로이드 앱 버전)<br>
https://play.google.com/store/apps/details?id=org.hempuli.baba

##### SharedPreference 관련 #####
SharedPreferences로 단순 데이터 저장하기<br>
https://developer.android.com/training/data-storage/shared-preferences?hl=ko

[JAVA] 안드로이드 SharedPreferences 사용하기<br>
https://koohee.tistory.com/m/12

##### SQLite 관련 #####
SQLite를 사용하여 데이터 저장<br>
https://developer.android.com/training/data-storage/sqlite?hl=ko

[Android] SQLite 사용하기<br>
https://velog.io/@jinny_0422/SQLite-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0

#### 수업 내용에서 차용한 것 ####
Tiled 맵 에디터를 이용한 맵 제작<br>
충돌 체크 구현 방식<br>
씬을 이용한 일시정지 구현 방식<br>
quicktype.io를 이용한 json 파싱코드 자동생성(타일셋 파일 파싱에만 적용)<br>
씬의 기본 터치이벤트 처리를 이용한 터치 처리 방식과 직접 작성한 코드로 별도처리하는 방식<br>
기타 등등...<br>

#### 직접 개발한것(+수업 외 요소에서 차용한 것) ####
슬라이드 동작을 이용한 조이스틱 없는 캐릭터 이동<br>
JsonObject를 이용한 json 파일 파싱<br>
SharedPreference, SQLite를 이용한 복잡한 데이터 저장/불러오기<br>

### 아쉬운 점들 ###
#### 하고 싶었지만 못 한 것들 ####
1. 미로를 랜덤 생성해서 제한적인 스테이지가 아닌 무한 스테이지를 구현하고 싶었지만 클리어 가능한 선에서의 적 배치와 획득 가능한 아이템 배치를 구현하기가 너무 어렵고 타일맵 구현에 시간을 지나치게 많이 소모해서 포기했습니다.
2. JsonObject 방식 대신 JsonReader를 사용하여 json 파싱을 좀 더 간결한 코드로 작성하거나 quicktype.io 같은 사이트로 json 파싱 코드를 자동생성했다면 다른 구현에 더 많은 시간을 쓸 수 있었을거라고 생각하는데 아쉽습니다.
3. 플레이어, 적, 아이템을 현재의 단순한 사각형 대신 에셋을 활용한 AnimSprite 같은 것으로 만들면 더 좋았을것 같습니다.
4. 게임 튜토리얼이나 설명 화면을 추가했다면 더 좋았을 것 같습니다.
5. 메인화면, 리더보드 등을 좀 더 꾸미거나 게임화면에서의 빈 공간을 그림 같은 것으로 채워넣었다면 더 좋았을 것 같습니다.

#### (앱을 스토어에 판다면) 팔기 위해 보충할 것들 ####
1. 아이템에 능력을 추가(공격을 1회 막아주는 방패 등)
2. 적의 종류, 능력 추가(플레이어를 쫓아오는 등)
3. 플레이어, 적, 아이템에 이미지, 애니메이션 추가
4. 게임 설명이나 튜토리얼 추가
5. 무한 스테이지 구현
6. 온라인 리더보드를 통한 경쟁요소 추가

#### 결국 해결하지 못한 문제/버그 ####
발견한 모든 문제는 해결하였습니다. 현재 발견되었지만 해결하지 못한 버그는 없습니다.<br>

#### 아쉬웠던 점에 대한 반성 ####
프로젝트 시작때 게임 아이디어를 짜는 데에 긴 시간을 투자하는 것이 시간 낭비라고 생각하여 게임을 최대한 간단히 구성했습니다. 하지만 결과적으로 게임에서 제일 중요한 재미가 부족한 게임이 된 것 같아 아쉽습니다.

### 수업에 대한 내용 ###
#### 이번 수업에서 기대한 것 ####
코틀린 기반 안드로이드 앱 개발<br>
안드로이드 게임 개발에 대한 전반적인 지식<br>

#### 이번 수업에서 실제로 얻은 것 ####
자바를 이용한 안드로이드 앱 개발 방법<br>
객체지향적으로 개발하는 방법<br>
좋은 코드를 짜기 위해 고민해야한는 요소들(읽기 쉬운 코드, 유지보수가 쉬운 코드를 짜려면 고려해야하는 것들)<br>
코드를 재사용하기 위해 고려해야하는 것들(어떤 코드를 재사용할 수 있을지, 코드를 재사용하려면 어떤일을 해야하는지)<br>

#### 더 좋은 수업이 되기 위해 변화할 점 ####
온라인수업을 했던 주차처럼 강의영상을 제공해주시는 것을 모든 수업에 확대하는 것에 대한 의견이 수업때 있었지만 개인적으로는 반대합니다.<br>
이유는 수업때 들은 내용을 소화하지 못하면 그 내용은 다시 배우기 어렵다는 압박감이 있지 않으면 수업에 대한 집중도가 떨어질 것 같기 때문입니다.<br>
대신 이번 학기에는 시간상의 이유로 진행하지 못한 수업을 영상 형식으로 제공해주시거나 이미 수업을 진행하신 내용에서 보충할 부분이나 추가로 더 말씀하실만한 내용이 있다면 그걸 영상으로 보여주시는 건 수업의 질에 도움이 될 것 같습니다.<br>

#### 2차 발표자료 ####
MainScene에 등장하는 game object에 대하여<br>
-클래스 구성 및 상호작용<br>
1. TiledMap<br>
   21*21개의 타일로 이루어진 맵<br>
   플레이어와 벽 타일, 출구의 충돌감지를 위한 타일 정보 유지<br>
   --상호작용<br>
   벽타일은 플레이어와 충돌시 플레이어 이동 취소<br>
   출구는 플레이어와 충돌시 플레이어를 초기위치로 이동, 점수 증가, 맵 변경<br>
   <br>
2. Player<br>
   플레이어 캐릭터<br>
   충돌을 제외한 플레이어 캐릭터의 전반을 담당<br>
   --상호작용<br>
   적 캐릭터와 충돌시 초기위치로 이동<br>
   아이템과 충돌시 아이템 삭제 및 점수추가<br>
   <br>
3. Enemy<br>
   적 NPC<br>
   정해진 구역을 반복이동(순찰)<br>
   --상호작용<br>
   플레이어와 충돌시 플레이어를 초기위치로 이동<br>
   <br>
4. Item<br>
   점수 아이템<br>
   아이템 종류별 점수 데이터 유지<br>
   --상호작용<br>
   플레이어와 충돌시 삭제 및 점수 추가<br>
   <br>
5. CollisionChecker<br>
   충돌감지용 객체(화면에 표시되지 않음)<br>
   플레이어와 적, 플레이어와 아이템, 플레이어와 타일의 충돌감지를 담당<br>

어려웠던 부분<br>
타일맵을 랜더링할때 뒤집힌 타일을 구현해야하는데, canvas.save와 restore를 사용하지 못하니 canvas 직접 돌릴 수 없고 비트맵을 돌려야하는 부분이 어려웠습니다.<br>

<br>
<br>

#### Todo List ####
미구현 클래스 목록
MapDataBundle.java
고정 스테이지 방식으로 할거면 EnemySpawnInfo를 쓰는 대신 그냥 Enemy를 생성해서 갖고 있어도 될 것 같다.
